<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Fullscreen - Sequential Workflow Designer</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

	<script src="../designer.js"></script>
	<link href="../designer.css" rel="stylesheet">

	<style>
		body {font: 14px/1.3em 'Open Sans', Arial, Verdana, Serif;}
		html, body {width: 100vw; height: 100vh; margin: 0; padding: 0; overflow: hidden;}
		#designer {width: 100vw; height: 100vh;}
	</style>
</head>
<body>
	<div id="designer"></div>

	<script>
		function task(internalType, name) {
			return {
				type: 'task',
				internalType,
				name
			};
		}

		function ifElse(iff, els) {
			return {
				type: 'switch',
				internalType: 'if',
				name: 'if',
				branches: {
					'true': {
						steps: iff
					},
					'false': {
						steps: els
					}
				}
			};
		}

		function toolboxGroup(name) {
			return {
				name,
				steps: [
					task('saveFile', 'Save file'),
					task('sendEmail', 'Send email'),
					ifElse([], [])
				]
			};
		}

		const configuration = {
			stepIconUrlProvider: (type, internalType) => {
				return `./icon-${internalType}.svg`
			},

			toolboxGroups: [
				toolboxGroup('Main'),
				toolboxGroup('File system'),
				toolboxGroup('E-mail')
			],

			stepValidator: (step) => {
				return (step.name.length % 2) === 0;
			},

			globalEditorProvider: () => {
				const e = document.createElement('div');
				e.innerText = 'global';
				return e;
			},

			stepEditorProvider: (step) => {
				const e = document.createElement('div');
				e.innerText = step.name;
				return e;
			}
		};

		const definition = {
			sequence: {
				steps: [
					ifElse(
						[
							task('saveFile', 'Save file')
						],
						[
							task('sendEmail', 'Send email')
						]
					)
				]
			}
		};

		const placeholder = document.getElementById('designer');
		const designer = window.sequentialWorkflowDesigner.create(placeholder, definition, configuration);
		designer.onDefinitionChanged.subscribe(() => {
			console.log('the definition has changed');
		});
	</script>
</body>
</html>
