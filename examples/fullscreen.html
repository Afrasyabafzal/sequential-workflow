<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Fullscreen - Sequential Workflow Designer</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

	<script src="../designer.js"></script>
	<link href="../designer.css" rel="stylesheet">

	<style>
		body {font: 14px/1.3em 'Open Sans', Arial, Verdana, Serif;}
		html, body {width: 100vw; height: 100vh; margin: 0; padding: 0; overflow: hidden;}
		#designer {width: 100vw; height: 100vh;}
	</style>
</head>
<body>
	<div id="designer"></div>

	<script>
		function uid() {
			return Math.ceil(Math.random() * 10**16).toString(16);
		}

		function task(type, name) {
			return {
				id: uid(),
				componentType: 'task',
				type,
				name,
				properties: {}
			};
		}

		function ifElse(iff, els) {
			return {
				id: uid(),
				componentType: 'switch',
				type: 'if',
				name: 'If',
				branches: {
					'true': {
						steps: iff
					},
					'false': {
						steps: els
					}
				},
				properties: {}
			};
		}

		function toolboxGroup(name) {
			return {
				name,
				steps: [
					task('save-file', 'Save file'),
					task('send-email', 'Send email'),
					ifElse([], [])
				],
				properties: {}
			};
		}

		const configuration = {

			toolbox: {
				isHidden: false,
				groups: [
					toolboxGroup('Main'),
					toolboxGroup('File system'),
					toolboxGroup('E-mail')
				]
			},

			steps: {
				iconUrlProvider: (componentType, type) => {
					return `./icon-${type}.svg`
				},

				validator: (step) => {
					return Math.random() > .5;
				}
			},

			editors: {
				globalEditorProvider: (d) => {
					const e = document.createElement('div');
					e.innerText = JSON.stringify(d);
					return e;
				},

				stepEditorProvider: (step) => {
					const e = document.createElement('div');
					e.innerText = JSON.stringify(step);
					return e;
				}
			}
		};

		const definition = {
			properties: {},
			sequence: {
				steps: [
					ifElse(
						[
							task('save-file', 'Save file')
						],
						[
							task('send-email', 'Send email')
						]
					)
				]
			}
		};

		const placeholder = document.getElementById('designer');
		const designer = window.sequentialWorkflowDesigner.create(placeholder, definition, configuration);
		designer.onDefinitionChanged.subscribe(() => {
			console.log('the definition has changed');
		});
	</script>
</body>
</html>
